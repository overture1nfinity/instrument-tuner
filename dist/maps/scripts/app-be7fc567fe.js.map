{"version":3,"sources":["scripts/app-be7fc567fe.js"],"names":["angular","module","component","controller","this","version","controllerAs","templateUrl","transclude","bindings","instance","tplScope","AppController","$scope","getUserMedia","AUDIO_CFG","audioContext","AudioMath","audioState","Alerts","ctrl","alerts","viewAlerts","enableMicAlert","notFoundAlert","notSupportedAlert","unknownAlert","prevAudioSignal","initAlerts","addAlert","gUMSuccess","stream","mediaSourceState","mediaSource","createMediaStreamSource","appProcessor","createScriptProcessor","FFT_SIZE","onaudioprocess","onAudioProcess","connect","destination","close","$digest","e","console","error","open","gUMError","err","name","$onInit","selectInput","call","navigator","audio","mandatory","googEchoCancellation","googAutoGainControl","googNoiseSuppression","googHighpassFilter","then","catch","samples","inputBuffer","getChannelData","avgSignal","calculateAverageSignal","Math","min","SIGNAL_RANGE","max","signal","SMOOTHING_CONSTANT","$broadcast","AudioStateFactory","pitch","volumePct","clipPct","clipping","pitchDelta","refPitch","note","TONE_NAMES","noteNum","shouldInit","factory","AudioMathFactory","_","pitchDetect","calculatePitchDelta","refFreq","freq","cents","log2","Infinity","Float32Array","maxMagnitude","i","length","s","SAMPLE_RATE","NFFT_SIZE","ReferencePitchMonitorController","prevInputFreq","$on","data","inputFreq","_default","autoCorrelate","isNaN","frequencyFromNoteNumber","toFixed","abs","PITCH_DELTA_ABSOLUTE_THRESHOLD","noteFromPitch","NaN","DbGaugeController","Canvas2DHandler","c2dh","canvasWidth","canvasHeight","volumePosRange","clipLinePosPct","clipColor","volumeColor","clip","onCanvasSizeChange","canvas","width","height","init","el","HTMLCanvasElement","setContext","getContext","draw","timeStamp","beginDraw","drawLine","clampedVolumePct","drawRect","endDraw","DbGaugeLink","$el","$attrs","$ctrl","directive","link","restrict","scope","requestAnimationFrame","_ctx","_rafId","ctx","CanvasRenderingContext2D","Object","create","clear","clearRect","x","y","w","h","fillStyle","fillRect","x1","y1","x2","y2","beginPath","moveTo","lineTo","strokeStyle","stroke","closePath","rafCb","service","AlertsService","srvc","type","closeable","additionalClasses","undefined","alert","id","show","push","remove","removeAlert","forEach","splice","openAlert","closeAlert","openAll","map","closeAll","removeAll","frequency","log","round","pow","centsOffFromPitch","floor","MIN_SAMPLES","GOOD_ENOUGH_CORRELATION","buf","sampleRate","SIZE","MAX_SAMPLES","best_offset","best_correlation","rms","foundGoodCorrelation","correlations","Array","val","sqrt","lastCorrelation","offset","correlation","window","constant","webkitRequestAnimationFrame","AudioContext","webkitAudioContext","mozAudioContext","mediaDevices","webkitGetUserMedia","mozGetUserMedia","runBlock","$log","run","routerConfig","$stateProvider","$urlRouterProvider","state","url","otherwise","config","configBlock","$locationProvider","$logProvider","html5Mode","debugEnabled","$templateCache","put"],"mappings":"CAAA,WACI,aAEAA,QAAQC,OAAO,UACX,MACA,iBALR,GAUA,WACI,aAEAD,QAAQC,OAAO,UAAUC,UAAU,cACjCC,WAQF,WACEC,KAAKC,QAAU,UARfC,aAAc,KACdC,YAAa,8EACbC,YAAY,IAPlB,GAkBA,WACI,aAEAR,QAAQC,OAAO,UAAUC,UAAU,cACjCC,WAOF,aANEG,aAAc,KACdC,YAAa,gFANnB,GAeA,WACI,aAEAP,QAAQC,OAAO,UAAUC,UAAU,eACjCC,WAQF,aAPEG,aAAc,KACdC,YAAa,gFACbC,YAAY,IAPlB,GAgBA,WACI,aAEAR,QAAQC,OAAO,UAAUC,UAAU,QACjCC,WAQF,aAPEG,aAAc,KACdC,YAAa,gEACbC,YAAY,IAPlB,GAgBA,WACI,aAEAR,QAAQC,OAAO,UAAUC,UAAU,UACjCC,WAWF,aAVEG,aAAc,KACdC,YAAa,mDACbE,UACEC,SAAU,IACVC,SAAU,OATlB,GAmBA,WACE,aAEAX,QAAQC,OAAO,OACb,YACA,eACA,WANJ,GAWA,WACI,aASA,SAASW,EAAcC,EAAQC,EAAcC,EAAWC,EAAcC,EAAWC,EAAYC,GAE3F,IAAIC,EAAOhB,KAAXgB,EAAIC,OAAOF,EACXC,EAAKE,YACLC,eAAkB,KAChBC,cAAA,KACAC,kBAAe,KACfC,aAAA,MAIF,IAAIC,EAAkB,KAEtBP,EAAKQ,WAAa,WAAlBR,EAAKE,WAAaC,eAAWJ,EAAAU,SAAA,UAAA,yCAAA,GAAA,GAC3BT,EAAKE,WAAWE,cAAAL,EAAiBU,SAAO,SAAS,wCACjDT,EAAKE,WAAWG,kBAAgBN,EAAOU,SAAS,SAAU,4CAC1DT,EAAKE,WAAWI,aAAAP,EAAoBU,SAAO,SAAS,uCAItDT,EAAKU,WAAa,SAASC,GAA3B,IACE,IAAIC,EAAAd,EAAAe,YACFD,EAAID,OAAmBf,EAAWkB,wBAAAH,GAIlCC,EAAiBG,aAAenB,EAAaoB,sBAAsBrB,EAAUsB,SAAU,EAAG,GAA1FL,EAAiBG,aAAAG,eAA4BlB,EAAAmB,eAG7CP,EAAiBD,OAAOS,QAAQR,EAAiBG,cAAjDH,EAAiBG,aAAOK,QAAQxB,EAAiByB,aAGjDrB,EAAKE,WAAWC,eAAemB,QAA/B7B,EAAK8B,UAIP,MAAMC,GAANC,QAASC,MAAAF,GACPxB,EAAAE,WAAcI,aAAAqB,SAKlB3B,EAAK4B,SAAW,SAASC,GAAzB,OAAKA,EAAAC,MACH,IAAO,gBACL9B,EAAKE,WAAAE,cAAAuB,OACH,MAGF,QAAA3B,EAAAE,WAAAI,aAAAqB,OAKFlC,EAAO8B,WAGTvB,EAAK+B,QAAU,WAAf/B,EAAKQ,cAMLR,EAAKgC,YAAc,SAASR,GAAvB9B,EAMHA,EAAauC,KAAbC,WAEEC,OACEC,WACEC,sBAAW,EACTC,qBAAA,EACAC,sBAAqB,EACrBC,oBAAA,MAKPC,KAAKzC,EAAKU,YAAVgC,MAAK1C,EAAK4B,UAjBX5B,EAAIE,WAAcG,kBAAAsB,QAuBpB3B,EAAKmB,eAAiB,SAASK,GAA/B,IAAKmB,EAAAnB,EAAAoB,YAAiBC,eAAY,GAC5BC,EAAYjD,EAAAkD,uBAA2BJ,GAC3CG,EAAIE,KAAYC,IAAAH,EAAUnD,EAAAuD,aAAuBC,KAKjDrD,EAAGsD,OAAA7C,EAAiByC,KAAAG,IAAAL,EAAAvC,EAAAZ,EAAA0D,oBAGfP,EAILrD,EAAO6D,WAAW,iBAAlB7D,EAAO6D,WAAW,aAAAX,QAAAA,IAGlBpC,EAAkBT,EAAWsD,yGA9GjCxE,QAAQC,OAAO,OAAOC,UAAU,WAAhCC,WAAQS,EACNN,aAAY,KACZC,YAAA,4CALN,GAwHA,WAAC,aAOG,SAASoE,EAAkB5D,GACvB,OADJkB,aACWF,OAAA,KACHI,aAAa,MAIbqC,OAFI,KAGJI,MAAO,KADPC,UAAQ,KACRC,QAAO,KACPC,SAAA,KACAC,WAAS,EACTC,UACAC,KAAAnE,EAAYoE,WAAA,GACZC,QAAU,KACNC,YAAM,4BAjBlBrF,QAAQC,OAAO,UAAUqF,QAAQ,aAAcX,GAHnD,GA6BA,WACI,aAEA,SAAQY,EAAiBC,EAAAzE,EAAQ0E,GAK7B,OASIC,oBAAqB,SAASC,EAASC,GACnC,IAAIC,EAAQ,KAYZ,OAbJF,GAAAC,IAKYC,EAJJF,IAAQC,EAII,KAAKxB,KAAK0B,KAAKH,EAAUC,IAAS,EAIlC,GAITC,GAQX1B,uBAAwB,SAASJ,GAC7B,IAAIS,GAAUuB,EAAAA,EADlB,GAAAhC,aAAwBiC,aAAS,CAG1B,IAAA,IAFCC,GAAUF,EAAAA,EAEXG,EAAA,EAAAA,EAAmBnC,EAAAoC,OAAcD,IAAA,CAC5B,IAAAE,EAAArC,EAAgBmC,GAIbD,EAAeG,IAAGH,EAAeG,GAGxC5B,EAHOyB,GAAkBlF,EAAAsF,YAAetF,EAAAuF,WAAA,GAM5C,OAHI9B,8CAhDhBxE,QAAAC,OAAA,UAAAqF,QAAA,YAAAC,GADJ,GA4DA,WACI,aADHvF,QAAWC,OAAA,OAAAC,UAAA,YACRC,WASA,aALEG,aAAc,KAFhBC,YAAe,sDAHnB,GAcA,WACI,aASA,SAJEgG,EAAa1F,EAAAE,EAAAE,EAAAC,EAAAuE,GAKb,IAAIrE,EAAOhB,KAEXS,EAAOK,WAAaA,EAHtBd,KAAAoG,cAAS,EAMP3F,EAAO4F,IAAI,YAAa,SAAS7D,EAAG8D,GAHpC,IAAAC,EAAOzF,EAAasD,OACfoC,GAAA,EAEL,GAAAD,GAAW5F,EAAauD,aAAYD,IAAM,CAEpC,IAAAO,EAAWa,EAAAoB,cAAAH,EAAA3C,QAAAhD,EAAAsF,cAEZS,MAAAlC,IAAaA,GAAU,GAKhBkC,MAAM5F,EAAW+D,SAASG,UAAalE,EAAW+D,SAASI,aAH7DnE,EAAQ8D,WAAY/D,EAAcyE,oBAKhCD,EAAYsB,wBAAwB7F,EAAW+D,SAASG,SAH1DR,GAAMoC,QAAU,KAQhB9F,EAJS+D,SAAQI,YAKjByB,MAAM5F,EAAW+D,SAASG,WACzBlE,EAAW+D,SAASC,MAHvBd,KAAA6C,IAAA/F,EAAA8D,aAAAjE,EAAAmG,kCAEEhG,EAAM+D,SAAWG,QAASK,EAAA0B,cAAAvC,GACzB1D,EAAW+D,SAASC,MAAA4B,MAAA5F,EAAA+D,SAAAG,UAAAlE,EAAA+D,SAAAG,SAAA,EAAArE,EAAAoE,WAAAjE,EAAA+D,SAAAG,QAAA,GAAA,GAAArE,EAAAoE,WAAA,GACrBjE,EAAS+D,SAAWI,YAAe,GAOrCnE,EAJI0D,MAAWA,EAKfxD,EAJIoF,cAAWG,GAGfC,GAAW,OAQZA,GAJI,EAONA,IACD1F,EAJG+D,SAAWC,KAAAnE,EAAAoE,WAAA,GAKdjE,EAAW+D,SAASG,QAAUgC,IAC9BlG,EAAW8D,WAAa,GAI1BnE,EAJE8B,oFAxDT3C,QAAWC,OAAA,OAAAC,UAAA,yBACRC,WAAAoG,EAIEjG,aAAc,KACdC,YAAa,oFANnB,GAmEA,WACI,aAaA,SALI8G,EAAOxG,EAAAE,EAAAG,EAAAoG,GAMT,IAAIlG,EAAOhB,KAEXA,KAAKW,UAAYA,EACjBX,KAAKc,WAAaA,EAJpBd,KAAAmH,KAASD,EACPlH,KAAIoH,YAAO,KAMXpH,KAAKqH,aAAe,KAJpBrH,KAAKsH,eAAY,KACjBtH,KAAKuH,eAAa,GAClBvH,KAAKwH,UAAO,MACZxH,KAAKyH,YAAc,UAEnBhH,EAAK4F,IAAA,gBAAiB,SAAA7D,EAAA8D,GACtBxF,EAAK2D,UAAiBT,KAAAC,IAAA,IAAAnD,EAAAsD,OAAAzD,EAAAuD,aAAAwD,MAEjB5G,EAAAsD,QAAczD,EAAAuD,aAAAwD,MAMf5G,EAAW6D,UAAW,EAJ1B7D,EAAW4D,QAAmC,GAAnC5D,EAA0B2D,UAAS,IAI1C3D,EAAW6D,UAAW,IAS1B3E,KAAK2H,mBALE,WAML3G,EALEoG,YAAWpG,EAAWmG,KAAAS,OAAAC,MAMxB7G,EAAKqG,aAAerG,EAAKmG,KAAKS,OAAOE,OACrC9G,EAAKsG,gBACHrD,IAAK,EAJTE,IAAKnD,EAAAuG,eAAqBvG,EAAAoG,cAS1BpH,KALI+H,KAAK,SAAAC,GAMP,KALEA,aAAUC,mBAMV,KAAM,qBAFV,IAAKL,EAAOI,EAOVJ,EALEE,OAAM,GAMR9G,EAAKmG,KAAKe,WAAWN,EAAOO,WAAW,OACvCnH,EAAK2G,qBAJL3G,EAAIoH,QAQNpI,KALEoI,KAAU,SAAAC,GAgBV,GAfArH,EAAKmG,KAAAmB,YAQLtH,EAAKmG,KAAKoB,SAJZvH,EAAKsG,eAAgBnD,IAAA,EACnBnD,EAAKsG,eAAKnD,IAAAnD,EAAAqG,aAMRrG,EAAKwG,WADLxG,EAAKF,WAAA2D,UAAoB,EAAK,CAC9B,IAAA+D,EAAKxE,KAAAC,IAAA,EAAAjD,EAAAF,WAAA2D,WAOLzD,EAAKmG,KAAKsB,SACRzH,EAAKsG,eAAerD,IAAK,EAJ1BuE,EAAgBxH,EAAAsG,eAAenD,IAAAnD,EAAAqG,aAChCrG,EAAIyG,aASHzG,EALCF,WAAA6D,UAMF3D,EALEmG,KAAKsB,SAMLzH,EAAKsG,eAAenD,IAAK,EACzBnD,EAAKF,WAAW4D,QAAQ1D,EAAKoG,YAAapG,EAAKqG,aAC/CrG,EAAKwG,WAITxG,EALImG,KAAKuB,QAAA1H,EAAWoH,OASxB,SAASO,EAAYlI,EAAQmI,EAAKC,EAAQC,GACxC,IACEA,EAAMf,KAAKa,EAAI,IAEjB,MAAMpG,GAJRC,QAASC,MAAAF,oEA7FT5C,QAAQC,OAAO,OAAOE,WAAW,oBAAqBkH,GACtDrH,QAAQC,OAAO,OAAOkJ,UAAU,UAAW,WAH9C,OACGhJ,WAAAkH,EAKI+B,KAAML,EAJVzI,aAAe,KACf+I,SAAQ,IACNC,YAJN,GA0GA,WACI,aAEAtJ,QAAQC,OAAO,UAHnB,GAOA,WAJI,aAKA,SAAAqH,EAAA9B,EAAA+D,GAMI,IAAIC,EAAO,KACXpJ,KAAKqJ,OAAS,KALlBrJ,KAAQ4H,OAAO,KAQX5H,KAAKkI,WAAa,SAASoB,GALtBA,aAAgBC,2BACjBH,EAAOE,EACNtJ,KAAA4H,OAASwB,EAAAxB,SAUd5H,KANImI,WAAG,WAOH,OAAGiB,aANQG,yBACFC,OAASC,OAAKL,GAQZ,MAGfpJ,KANI0J,MAAG,WAOHN,EANIO,UAAO,EAAO,EAAA3J,KAAO4H,OAAAC,MAAA7H,KAAA4H,OAAAE,SAS7B9H,KAAKyI,SAAW,SAASmB,EAAGC,EAAGC,EAAGC,EAAG/D,GAC9BoD,IALFA,EAAQY,UAAWhE,EACpBoD,EAAKa,SAAaL,EAAGC,EAAAC,EAAKC,KAU9B/J,KANIuI,SAAS,SAAA2B,EAAAC,EAAAC,EAAAC,EAAArE,GAONoD,IALCA,EAAKkB,YAOLlB,EAAKmB,OAAOL,EAAIC,GAChBf,EAAKoB,OAAOJ,EAAIC,GAChBjB,EAAKqB,YAAczE,GAAK,QAL3BoD,EAAAsB,SACEtB,EAAMuB,cAUb3K,KAAKsI,UANQ,WAOTtI,KANI0J,SASR1J,KAAK0I,QAAU,SAASkC,GACpB5K,KAAKqJ,OAASF,EAAsByB,GAAS,uDAjDrDhL,QAAQC,OAAO,OAAOgL,QAAQ,kBAAmB3D,GAHrD,GA0DA,WACI,aADH,SAAW4D,EAAA1F,GACR,IAAA2F,EAAA/K,KAOI+K,EAAKzE,QALTyE,EAAQtJ,SAAO,SAAOuJ,EAAQ7K,EAAUwC,EAAAsI,EAAAC,GAShCvI,OAAiBwI,IAATxI,GAAsBA,EAL9BsI,OAAOE,IAAAF,GAAAA,EASPC,OAA2CC,IAAtBD,EAAmCA,EAAoB,GAE5E,IAAIE,GANJC,GAAQrL,KAAAsG,KAASP,OAQbiF,KAAMA,EANVM,KAAA3I,EAQIxC,YAAaA,EANjB+K,kBAAqBA,EAQjBD,UAAWA,GAGfjL,KAPIsG,KAAMiF,KAAAH,GAuBV,OApBIzI,KAAA,WACAyI,EAAAE,MAAW,GAGfhJ,MAAU,WAQF8I,EAAME,MAAO,GAGjBE,OAPI,WAQAT,EAAKU,YAAYL,EAAMC,OAOnCN,EAAKU,YAPY,SAAAJ,GAQbjG,EAAEsG,QAAQ1L,KAAKsG,KAAM,SAAS8E,EAAOtF,GAEjC,GAAGsF,EAAMC,KAAOA,EAEZ,OARDN,EAAAzE,KAAAqF,OAAA7F,EAAA,IAQQ,KAKnBiF,EAAKa,UAPY,SAAOP,GAQpBjG,EAAEsG,QAPM1L,KAAKsG,KAAK,SAAU8E,GASxB,GAAGA,EAAMC,KAAOA,EAEZ,OADAD,EAAME,MAAO,GACN,KAKnBP,EAAKc,WAPY,SAAOR,GAQpBjG,EAAEsG,QAPM1L,KAAMsG,KAAO,SAAA8E,GASjB,GAAGA,EAAMC,KAAOA,EAEZ,OADAD,EAAME,MAAO,GACN,KAKnBP,EAAKe,QAPM,WAQP1G,EAAE2G,IAAI/L,KAPEsG,KAAM,SAAO8E,GAQjBA,EAPIE,MAAO,KAWnBP,EAAKiB,SAAW,WANhB5G,EAAK2G,IAAA/L,KAAUsG,KAAA,SAAW8E,GACpBA,EAAIE,MAAW,KAWrBP,EAAKkB,UAAY,WANjBjM,KAAKsG,yBA/ET1G,QAAQC,OAAO,OAAOgL,QAAQ,SAAUC,GAH5C,GAmHA,IAAIzF,eAEJA,YAAY0B,cAAgB,SAAUmF,GACrC,IAAIlH,EAAgBhB,KAAKmI,IAAKD,EAAY,KAAMlI,KAAKmI,IAAI,GAA3C,GACd,OAAOnI,KAAKoI,MAAOpH,GAAY,IAJhCK,YAAIsB,wBAAc,SAAA7B,GAQjB,OAAO,IAAMd,KAAKqI,IAAI,GAAGvH,EAAK,IAAI,KAGnCO,YAPQiH,kBAAwB,SAAAJ,EAAApH,GAQ/B,OAAOd,KAAKuI,MAAO,KAAOvI,KAAK0B,KAAMwG,EAAY7G,YAAYsB,wBAAyB7B,MAmCvF,IAAI0H,YAAc,EACdC,wBAA0B,GAE9BpH,YAAYoB,cAAgB,SAAUiG,EAAKC,GAC1C,IAAIC,EAAOF,EAAI3G,OACX8G,EAAc7I,KAAKuI,MAAMK,EAAK,GAC9BE,GAAe,EANhBC,EAAc,EACdC,EAAA,EAQCC,GAAuB,EAN5BC,EAAY,IAAAC,MAAgBN,GACvB/G,EAAA,EAEJ,IAAIA,EAAA,EAAAA,EAAA8G,EAAA9G,IAAe,CACnB,IAAIsH,EAAAV,EAAA5G,GACJkH,GAAII,EAAMA,EAWV,IATAJ,EAAIhJ,KAAAqJ,KAAAL,EAAeJ,IASX,GANR,OAAS,EAYT,IAAK,IARLU,EAAoB,EAQXC,EAASf,YAAae,EAASV,EAAaU,IAAU,CAN/D,IAAIC,EAAI,EASP,IAAK1H,EAAE,EAAGA,EAAE+G,EAAa/G,IACxB0H,GAAexJ,KAAK6C,IAAK6F,EAAI5G,GAAK4G,EAAI5G,EAAEyH,IAHzC,GAFDC,EAAI,EAAgBA,EAAAX,EACpBK,EAASK,GAASC,EACbA,EAAAf,yBAAce,EAAAF,EAQjBL,GAAuB,EANnBO,EAAOT,IACXA,EAAoBS,EAQnBV,EAAcS,QALhB,GAAAN,EAAuB,CAkBtB,OAAON,GAAYG,EAAa,IADnBI,EAAaJ,EAAY,GAAKI,EAAaJ,EAAY,IAAII,EAAaJ,KAGtFQ,EAAkBE,EAEnB,OAAIT,EAAmB,IALjBJ,EAASG,GASP,GAITW,OAAOpI,YAAcA,YAErB,WANC,aASGzF,QAAQC,OAAO,OACd6N,SAAS,IAAKD,OAAOrI,GAN1BsI,SAAO,wBAAcD,OAAAtE,uBAAAsE,OAAAE,6BAQhBD,SAAS,eAAgB,IAAKD,OAAOG,cAAgBH,OAAOI,oBAAsBJ,OAAOK,kBAN7FJ,SAAW,eACRxK,UAAA6K,aAAArN,cAQIwC,UAAU6K,aAAaC,oBAN3B9K,UAAQ6K,aAAOE,iBACdP,SAAS,cAAYD,OAAApI,aAJ1B,GAeA,WACI,aAEAzF,QAPCC,OAAS,UAST6N,SAAS,aACN5G,+BAAgC,GANvCb,YAAW,MACRhE,SAAA,KAQIiE,UAAW,KANf7B,mBAAe,GAQXH,cANHD,IAAS,GACNE,IAAA,IACAuD,KAAA,KAEA3C,YACA,KACA,IAAA,KAAA,IAAc,KAAA,IAAA,IACV,KAAK,IAAA,KAAA,IAAA,KAAA,OAZjB,GAyBA,WACI,aAKA,SAASmJ,EAASC,GANrBA,EAAAhC,IAAW,iCAGRvM,QAAQC,OAAO,UAAUuO,IAAIF,GAHjC,GAYA,WACE,aAKA,SAASA,EAASC,GAChBA,EAAKhC,IAAI,8BAJXvM,QARIC,OAAS,OAAAuO,IAAWF,GAK1B,GAYA,WACE,aAKA,SAASG,EAAaC,EAAgBC,GACpCD,EAAeE,MAAM,OACnBC,IAAK,IARV3O,UAAW,QAYRyO,EAAmBG,UAAU,uDAlB/B9O,QAAAC,OAAS,OAAS8O,OAAMN,GAM1B,GAiBA,WACE,aAKA,SAASO,EAAYC,EAAmBC,GACtCD,EACIE,WAAU,GARjBD,EACCE,cAAA,kDAEApP,QAAQC,OAAO,OAAO8O,OAAOC,GAH/B,GAgBAhP,QAAQC,OAAO,OAAOuO,KAAK,iBAAkB,SAASa,GAAiBA,EAAeC,IAAI,aAAa,ypCACvGD,EAXWC,IAAA,+EAA6C,6PAYxDD,EAXIC,IAAA,uCAAA,uwCAYJD,EAXQC,IAAU,iDAAA,YAYlBD,EAAeC,IAAI,gDAAgD,mfACnED,EAXIC,IAAA,4DAAA,2EAYJD,EAXQC,IAAA,4EAAa,kGAYrBD,EAAeC,IAAI,0EAA0E,0YAC7FD,EAAeC,IAAI,0EAA0E","file":"scripts/app-be7fc567fe.js","sourcesContent":["(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common', [\r\n        'lib',\r\n        'ui.bootstrap',\r\n    ]);\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').component('pageHeader', {\r\n      controller: PageHeaderController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'common\\\\components\\\\page.collection\\\\page-header\\\\page-header.template.html',\r\n      transclude: true,\r\n    });\r\n  \r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function PageHeaderController() {\r\n      this.version = 'v0.0.1';\r\n    }\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').component('pageFooter', {\r\n      controller: PageFooterController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'common\\\\components\\\\page.collection\\\\page-footer\\\\page-footer.template.html',\r\n    });\r\n  \r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function PageFooterController() {}\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').component('pageContent', {\r\n      controller: PageContentController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'common\\\\components\\\\page.collection\\\\page-content\\\\page-content.template.html',\r\n      transclude: true,\r\n    });\r\n  \r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function PageContentController() {}\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').component('page', {\r\n      controller: PageController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'common\\\\components\\\\page.collection\\\\page\\\\page.template.html',\r\n      transclude: true,\r\n    });\r\n  \r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function PageController() {}\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').component('alerts', {\r\n      controller: AlertsController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'common\\\\components\\\\alerts\\\\alerts.template.html',\r\n      bindings: {\r\n        instance: '<',\r\n        tplScope: '<',\r\n      },\r\n    });\r\n  \r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function AlertsController() {}\r\n  \r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('app', [\r\n    'ui.router',\r\n    'ui.bootstrap',\r\n    'common',\r\n  ]);\r\n\r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('app').component('appRoot', {\r\n      controller: AppController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'app\\\\components\\\\app\\\\app.template.html',\r\n    });\r\n  \r\n    /** @ngInject */\r\n    function AppController($scope, getUserMedia, AUDIO_CFG, audioContext, AudioMath, audioState, Alerts) {\r\n\r\n      var ctrl = this;\r\n      ctrl.alerts = Alerts;\r\n      ctrl.viewAlerts = {\r\n        enableMicAlert: null,\r\n        notFoundAlert: null,\r\n        notSupportedAlert: null,\r\n        unknownAlert: null,\r\n      };\r\n\r\n      var prevAudioSignal = null;\r\n\r\n      ctrl.initAlerts = function() {\r\n        ctrl.viewAlerts.enableMicAlert = Alerts.addAlert('primary', 'inline-partials/enable-mic-alert.html', true, false);\r\n        ctrl.viewAlerts.notFoundAlert = Alerts.addAlert('danger', 'inline-partials/not-found-alert.html');\r\n        ctrl.viewAlerts.notSupportedAlert = Alerts.addAlert('danger', 'inline-partials/not-supported-alert.html');\r\n        ctrl.viewAlerts.unknownAlert = Alerts.addAlert('danger', 'inline-partials/unknown-alert.html');\r\n      }\r\n\r\n      ctrl.gUMSuccess = function(stream) {\r\n        try {\r\n          var mediaSourceState = audioState.mediaSource;\r\n          mediaSourceState.stream = audioContext.createMediaStreamSource(stream);\r\n\r\n          // using only 1 processor to make sure all gauges are reading from the exact same data\r\n          mediaSourceState.appProcessor = audioContext.createScriptProcessor(AUDIO_CFG.FFT_SIZE, 2, 1);\r\n          mediaSourceState.appProcessor.onaudioprocess = ctrl.onAudioProcess;\r\n  \r\n          mediaSourceState.stream.connect(mediaSourceState.appProcessor);\r\n          mediaSourceState.appProcessor.connect(audioContext.destination);\r\n  \r\n          ctrl.viewAlerts.enableMicAlert.close();\r\n          $scope.$digest();\r\n        }\r\n\r\n        catch(e) {\r\n          console.error(e);\r\n          ctrl.viewAlerts.unknownAlert.open();\r\n        }\r\n      };\r\n\r\n      ctrl.gUMError = function(err) {\r\n        switch(err.name) {\r\n          case 'NotFoundError':\r\n            ctrl.viewAlerts.notFoundAlert.open();\r\n            break;\r\n\r\n          default:\r\n            ctrl.viewAlerts.unknownAlert.open();\r\n            break;\r\n        }\r\n\r\n        $scope.$digest();\r\n      };\r\n\r\n      ctrl.$onInit = function() {\r\n        ctrl.initAlerts();\r\n      };\r\n\r\n      // tested selectInput with a mock.\r\n      // istanbul ignore next\r\n      ctrl.selectInput = function(e) {\r\n        if(!getUserMedia) {\r\n          ctrl.viewAlerts.notSupportedAlert.open();\r\n          return;\r\n        }\r\n\r\n        getUserMedia.call(\r\n          navigator, \r\n          {\r\n            audio: {\r\n              mandatory: {\r\n                googEchoCancellation: false,\r\n                googAutoGainControl: false,\r\n                googNoiseSuppression: false,\r\n                googHighpassFilter: false,\r\n              }\r\n            }\r\n          })\r\n        .then(ctrl.gUMSuccess)\r\n        .catch(ctrl.gUMError);\r\n      };\r\n\r\n      // tested onAudioProcess with a mock.\r\n      // istanbul ignore next\r\n      ctrl.onAudioProcess = function(e) {\r\n        var samples = e.inputBuffer.getChannelData(0);\r\n        var avgSignal = AudioMath.calculateAverageSignal(samples);\r\n        avgSignal = Math.min(avgSignal, AUDIO_CFG.SIGNAL_RANGE.max);\r\n\r\n\r\n        // smooth\r\n        if(prevAudioSignal) {\r\n          audioState.signal = Math.max(avgSignal, prevAudioSignal*AUDIO_CFG.SMOOTHING_CONSTANT);\r\n        }\r\n        else {\r\n          audioState.signal = avgSignal;\r\n        }\r\n\r\n        $scope.$broadcast('updateDbGauge'); // need to update db gauge before anything else\r\n        $scope.$broadcast('updateRpm', { samples: samples });\r\n\r\n        prevAudioSignal = audioState.signal;\r\n      };\r\n      \r\n    }\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('common').factory('audioState', AudioStateFactory);\r\n\r\n    /** @ngInject */\r\n    /* istanbul ignore next */\r\n    function AudioStateFactory(AUDIO_CFG) {\r\n        return {\r\n            mediaSource: {\r\n                stream: null,\r\n                appProcessor: null,\r\n            },\r\n            signal: null,\r\n            pitch: null, // Hz\r\n            volumePct: null,\r\n            clipPct: null,\r\n            clipping: null,\r\n            pitchDelta: 0, // cents\r\n            refPitch: {\r\n                note: AUDIO_CFG.TONE_NAMES[0],\r\n                noteNum: null,\r\n                shouldInit: true, // this property will only be defined for the first update cycle / tick\r\n            },\r\n        };\r\n    }\r\n    \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('common').factory('AudioMath', AudioMathFactory);\r\n\r\n    /** @ngInject */\r\n    function AudioMathFactory(_, AUDIO_CFG, pitchDetect) {\r\n\r\n        return {\r\n            /**\r\n             * @summary Calculates the amount of cents a frequency is off of a reference pitch.\r\n             * @description\r\n             * Uses this formula: n = 1200*log2(b/a) -- 'a' and 'b' are the 2 subject frequencies.\r\n             * @param {number} refFreq The frequency of the reference pitch.\r\n             * @param {number} freq The subject frequency in Hz.\r\n             * @returns {number || null} Null if something went wrong, else cent value.\r\n             */\r\n            calculatePitchDelta: function(refFreq, freq) {\r\n                var cents = null;\r\n\r\n                if(refFreq && freq) {\r\n                    if(refFreq !== freq) {\r\n                        cents = 1200*Math.log2(refFreq / freq) * -1; // 100 cents should be the maximum output\r\n                    }\r\n\r\n                    else {\r\n                        cents = 0; // no difference\r\n                    }\r\n                }\r\n\r\n                return cents;\r\n            },\r\n\r\n            /**\r\n             * @summary Calculates the average signal from a Float32Array of signal values.\r\n             * @param {Float32Array} samples The samples of signal data to calculate the average of.\r\n             * @returns {float} The average signal from samples.\r\n             */\r\n            calculateAverageSignal: function(samples) {\r\n                var signal = -Infinity;\r\n\r\n                if(samples instanceof Float32Array) {\r\n                    var maxMagnitude = -Infinity;\r\n\r\n                    for(var i = 0; i < samples.length; i++) {\r\n                        var s = samples[i];\r\n                        if(maxMagnitude < s) maxMagnitude = s;\r\n                    }\r\n\r\n                    signal = (maxMagnitude * (AUDIO_CFG.SAMPLE_RATE / AUDIO_CFG.NFFT_SIZE)) / 10\r\n                }\r\n\r\n                return signal;\r\n            },\r\n\r\n        };\r\n    }\r\n\r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('app').component('settings', {\r\n      controller: SettingsController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'app\\\\components\\\\settings\\\\settings.template.html',\r\n    });\r\n  \r\n    /** @ngInject */\r\n    function SettingsController() {}\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('app').component('referencePitchMonitor', {\r\n      controller: ReferencePitchMonitorController,\r\n      controllerAs: 'vm',\r\n      templateUrl: 'app\\\\components\\\\reference-pitch-monitor\\\\reference-pitch-monitor.template.html',\r\n    });\r\n  \r\n    /** @ngInject */\r\n    function ReferencePitchMonitorController($scope, AUDIO_CFG, AudioMath, audioState, pitchDetect) {\r\n      var ctrl = this;\r\n\r\n      $scope.audioState = audioState; // isolated scope\r\n      this.prevInputFreq = 0;\r\n\r\n      $scope.$on('updateRpm', function(e, data) {\r\n        var inputFreq = audioState.signal;\r\n        var _default = false;\r\n        \r\n        if(inputFreq >= AUDIO_CFG.SIGNAL_RANGE.min) {\r\n\r\n            var pitch = pitchDetect.autoCorrelate(data.samples, AUDIO_CFG.SAMPLE_RATE);\r\n\r\n            if(!isNaN(pitch) && pitch > -1) {\r\n              if(!isNaN(audioState.refPitch.noteNum) && !audioState.refPitch.shouldInit) {\r\n                audioState.pitchDelta = AudioMath.calculatePitchDelta(\r\n                  pitchDetect.frequencyFromNoteNumber(audioState.refPitch.noteNum),\r\n                  pitch).toFixed(1);\r\n              }\r\n              \r\n              if(\r\n                audioState.refPitch.shouldInit || \r\n                isNaN(audioState.refPitch.noteNum) || \r\n                !audioState.refPitch.note || \r\n                Math.abs(audioState.pitchDelta) >= AUDIO_CFG.PITCH_DELTA_ABSOLUTE_THRESHOLD) {\r\n  \r\n                  audioState.refPitch.noteNum = pitchDetect.noteFromPitch(pitch);\r\n                  audioState.refPitch.note = (!isNaN(audioState.refPitch.noteNum) && audioState.refPitch.noteNum > -1) ? AUDIO_CFG.TONE_NAMES[(audioState.refPitch.noteNum % 12)+1] : AUDIO_CFG.TONE_NAMES[0];\r\n                  audioState.refPitch.shouldInit = false;\r\n              }\r\n  \r\n              audioState.pitch = pitch;\r\n              ctrl.prevInputFreq = inputFreq;\r\n            }\r\n\r\n            else _default = true;\r\n\r\n        }\r\n\r\n        else _default = true;\r\n\r\n\r\n        if(_default) {\r\n          audioState.refPitch.note = AUDIO_CFG.TONE_NAMES[0];\r\n          audioState.refPitch.noteNum = NaN;\r\n          audioState.pitchDelta = 0;\r\n        }\r\n\r\n\r\n        $scope.$digest();\r\n\r\n      });\r\n    }\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n    angular.module('app').controller('DbGaugeController', DbGaugeController); // for testing\r\n    angular.module('app').directive('dbGauge', function() {\r\n      return {\r\n        controller: DbGaugeController,\r\n        link: DbGaugeLink,\r\n        controllerAs: 'vm',\r\n        restrict: 'A',\r\n        scope: {},\r\n      }\r\n    });\r\n  \r\n    /** @ngInject */\r\n    function DbGaugeController($scope, AUDIO_CFG, audioState, Canvas2DHandler) {\r\n      var ctrl = this;\r\n\r\n      this.AUDIO_CFG = AUDIO_CFG;\r\n      this.audioState = audioState;\r\n      this.c2dh = Canvas2DHandler;\r\n      this.canvasWidth = null;\r\n      this.canvasHeight = null;\r\n      this.volumePosRange = null;\r\n      this.clipLinePosPct = 0.90;\r\n      this.clipColor = 'red';\r\n      this.volumeColor = '#3ae024';\r\n\r\n      $scope.$on('updateDbGauge', function(e, data) {\r\n        audioState.volumePct = Math.min(1.5, audioState.signal / AUDIO_CFG.SIGNAL_RANGE.clip); // 150% is max clip range\r\n\r\n        if(audioState.signal >= AUDIO_CFG.SIGNAL_RANGE.clip) {\r\n          audioState.clipping = true;\r\n          audioState.clipPct = (audioState.volumePct - 1) * 2; // 50% actual = 100% displayed\r\n        }\r\n\r\n        else {\r\n          audioState.clipping = false;\r\n        }\r\n      });\r\n\r\n      this.onCanvasSizeChange = function() {\r\n        ctrl.canvasWidth = ctrl.c2dh.canvas.width;\r\n        ctrl.canvasHeight = ctrl.c2dh.canvas.height;\r\n        ctrl.volumePosRange = {\r\n          min: 0,\r\n          max: ctrl.clipLinePosPct*ctrl.canvasWidth,\r\n        };\r\n      }\r\n\r\n      this.init = function(el) {\r\n        if(!(el instanceof HTMLCanvasElement)) {\r\n          throw 'InvalidCanvasError';\r\n        }\r\n\r\n        var canvas = el;\r\n        \r\n        canvas.height = 40;\r\n        ctrl.c2dh.setContext(canvas.getContext('2d'));\r\n        ctrl.onCanvasSizeChange(); // init these values\r\n        ctrl.draw(); // start draw cycle\r\n      }\r\n\r\n      this.draw = function(timeStamp) {\r\n        ctrl.c2dh.beginDraw();\r\n\r\n        // clip line\r\n        ctrl.c2dh.drawLine(\r\n          ctrl.volumePosRange.max, 0, \r\n          ctrl.volumePosRange.max, ctrl.canvasHeight,\r\n          ctrl.clipColor\r\n        );\r\n\r\n        // volume bar\r\n        if(ctrl.audioState.volumePct > 0) {\r\n          var clampedVolumePct = Math.min(1, ctrl.audioState.volumePct);\r\n\r\n          ctrl.c2dh.drawRect(\r\n            ctrl.volumePosRange.min, 0, \r\n            clampedVolumePct*ctrl.volumePosRange.max, ctrl.canvasHeight, \r\n            ctrl.volumeColor);\r\n        }\r\n\r\n        // clip bar\r\n        if(ctrl.audioState.clipping) {\r\n          ctrl.c2dh.drawRect(\r\n            ctrl.volumePosRange.max, 0, \r\n            ctrl.audioState.clipPct*ctrl.canvasWidth, ctrl.canvasHeight,\r\n            ctrl.clipColor\r\n          );\r\n        }\r\n\r\n        ctrl.c2dh.endDraw(ctrl.draw);\r\n      }\r\n    }\r\n\r\n    function DbGaugeLink($scope, $el, $attrs, $ctrl) {\r\n      try {\r\n        $ctrl.init($el[0]);\r\n      }\r\n      catch(e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('lib', []);\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('lib').service('Canvas2DHandler', Canvas2DHandler);\r\n\r\n    /** @ngInject */\r\n    function Canvas2DHandler(_, requestAnimationFrame) {\r\n        var _ctx = null;\r\n        this._rafId = null;\r\n        this.canvas = null;\r\n\r\n        this.setContext = function(ctx) {\r\n            if(ctx instanceof CanvasRenderingContext2D) {\r\n                _ctx = ctx;\r\n                this.canvas = _ctx.canvas;\r\n            }\r\n        }\r\n\r\n        this.getContext = function() {\r\n            if(_ctx instanceof CanvasRenderingContext2D)\r\n                return Object.create(_ctx);\r\n            else\r\n                return null;\r\n        }\r\n\r\n        this.clear = function() {\r\n            _ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n\r\n        this.drawRect = function(x, y, w, h, s) {\r\n            if(_ctx) {\r\n                _ctx.fillStyle = s;\r\n                _ctx.fillRect(x, y, w, h);\r\n            }\r\n        }\r\n\r\n        this.drawLine = function(x1, y1, x2, y2, s) {\r\n            if(_ctx) {\r\n                _ctx.beginPath();\r\n                _ctx.moveTo(x1, y1);\r\n                _ctx.lineTo(x2, y2);\r\n                _ctx.strokeStyle = s || 'black';\r\n                _ctx.stroke();\r\n                _ctx.closePath();\r\n            }\r\n        }\r\n\r\n        this.beginDraw = function() {\r\n            this.clear();\r\n        }\r\n\r\n        this.endDraw = function(rafCb) {\r\n            this._rafId = requestAnimationFrame(rafCb || function() {});\r\n        }\r\n    }\r\n    \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('lib').service('Alerts', AlertsService);\r\n\r\n    /** @ngInject */\r\n    function AlertsService(_) {\r\n        var srvc = this;\r\n        srvc.data = [];\r\n\r\n        srvc.addAlert = function(type, templateUrl, open, closeable, additionalClasses) {\r\n            /* istanbul ignore next */\r\n            open = (open !== undefined) ? open : false;\r\n            /* istanbul ignore next */\r\n            closeable = (closeable !== undefined) ? closeable : true;\r\n            /* istanbul ignore next */\r\n            additionalClasses = (additionalClasses !== undefined) ? additionalClasses : '';\r\n            \r\n            var alert = {\r\n                id: this.data.length,\r\n                type: type,\r\n                show: open,\r\n                templateUrl: templateUrl,\r\n                additionalClasses: additionalClasses,\r\n                closeable: closeable,\r\n            };\r\n\r\n            this.data.push(alert);\r\n\r\n            var alertHandle = {\r\n                open: function() {\r\n                    alert.show = true;\r\n                },\r\n\r\n                close: function() {\r\n                    alert.show = false;\r\n                },\r\n\r\n                remove: function() {\r\n                    srvc.removeAlert(alert.id);\r\n                },\r\n            };\r\n\r\n            return alertHandle;\r\n        }\r\n\r\n        srvc.removeAlert = function(id) {\r\n            _.forEach(this.data, function(alert, i) {\r\n                /* istanbul ignore else */\r\n                if(alert.id === id) {\r\n                    srvc.data.splice(i, 1);\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n\r\n        srvc.openAlert = function(id) {\r\n            _.forEach(this.data, function(alert) {\r\n                /* istanbul ignore else */\r\n                if(alert.id === id) {\r\n                    alert.show = true;\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n\r\n        srvc.closeAlert = function(id) {\r\n            _.forEach(this.data, function(alert) {\r\n                /* istanbul ignore else */\r\n                if(alert.id === id) {\r\n                    alert.show = false;\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n\r\n        srvc.openAll = function() {\r\n            _.map(this.data, function(alert) {\r\n                alert.show = true;\r\n            });\r\n        };\r\n\r\n        srvc.closeAll = function() {\r\n            _.map(this.data, function(alert) {\r\n                alert.show = false;\r\n            });\r\n        };\r\n\r\n        srvc.removeAll = function() {\r\n            this.data = [];\r\n        };\r\n    }\r\n    \r\n})();\r\n\n/*\r\nThe MIT License (MIT)\r\nCopyright (c) 2014 Chris Wilson\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n*/\r\n\r\nvar pitchDetect = {};\r\n\r\npitchDetect.noteFromPitch = function( frequency ) {\r\n\tvar noteNum = 12 * (Math.log( frequency / 440 )/Math.log(2) );\r\n\treturn Math.round( noteNum ) + 69;\r\n}\r\n\r\npitchDetect.frequencyFromNoteNumber = function( note ) {\r\n\treturn 440 * Math.pow(2,(note-69)/12);\r\n}\r\n\r\npitchDetect.centsOffFromPitch = function( frequency, note ) {\r\n\treturn Math.floor( 1200 * Math.log2( frequency / pitchDetect.frequencyFromNoteNumber( note )) );\r\n}\r\n\r\n// this is a float version of the algorithm below - but it's not currently used.\r\n/*\r\nfunction autoCorrelateFloat( buf, sampleRate ) {\r\n\tvar MIN_SAMPLES = 4;\t// corresponds to an 11kHz signal\r\n\tvar MAX_SAMPLES = 1000; // corresponds to a 44Hz signal\r\n\tvar SIZE = 1000;\r\n\tvar best_offset = -1;\r\n\tvar best_correlation = 0;\r\n\tvar rms = 0;\r\n\tif (buf.length < (SIZE + MAX_SAMPLES - MIN_SAMPLES))\r\n\t\treturn -1;  // Not enough data\r\n\tfor (var i=0;i<SIZE;i++)\r\n\t\trms += buf[i]*buf[i];\r\n\trms = Math.sqrt(rms/SIZE);\r\n\tfor (var offset = MIN_SAMPLES; offset <= MAX_SAMPLES; offset++) {\r\n\t\tvar correlation = 0;\r\n\t\tfor (var i=0; i<SIZE; i++) {\r\n\t\t\tcorrelation += Math.abs(buf[i]-buf[i+offset]);\r\n\t\t}\r\n\t\tcorrelation = 1 - (correlation/SIZE);\r\n\t\tif (correlation > best_correlation) {\r\n\t\t\tbest_correlation = correlation;\r\n\t\t\tbest_offset = offset;\r\n\t\t}\r\n\t}\r\n\tif ((rms>0.1)&&(best_correlation > 0.1)) {\r\n\t\tconsole.log(\"f = \" + sampleRate/best_offset + \"Hz (rms: \" + rms + \" confidence: \" + best_correlation + \")\");\r\n\t}\r\n//\tvar best_frequency = sampleRate/best_offset;\r\n}\r\n*/\r\n\r\nvar MIN_SAMPLES = 0;  // will be initialized when AudioContext is created.\r\nvar GOOD_ENOUGH_CORRELATION = 0.9; // this is the \"bar\" for how close a correlation needs to be\r\n\r\npitchDetect.autoCorrelate = function( buf, sampleRate ) {\r\n\tvar SIZE = buf.length;\r\n\tvar MAX_SAMPLES = Math.floor(SIZE/2);\r\n\tvar best_offset = -1;\r\n\tvar best_correlation = 0;\r\n\tvar rms = 0;\r\n\tvar foundGoodCorrelation = false;\r\n\tvar correlations = new Array(MAX_SAMPLES);\r\n\tvar i = 0;\r\n\r\n\tfor (i=0;i<SIZE;i++) {\r\n\t\tvar val = buf[i];\r\n\t\trms += val*val;\r\n\t}\r\n\trms = Math.sqrt(rms/SIZE);\r\n\t/* changed from 0.01 to 0.1 below */\r\n\tif (rms<0.1) // not enough signal\r\n\t\treturn -1;\r\n\r\n\t\r\n\r\n\tvar lastCorrelation=1;\r\n\tfor (var offset = MIN_SAMPLES; offset < MAX_SAMPLES; offset++) {\r\n\t\tvar correlation = 0;\r\n\r\n\t\tfor (i=0; i<MAX_SAMPLES; i++) {\r\n\t\t\tcorrelation += Math.abs((buf[i])-(buf[i+offset]));\r\n\t\t}\r\n\t\tcorrelation = 1 - (correlation/MAX_SAMPLES);\r\n\t\tcorrelations[offset] = correlation; // store it, for the tweaking we need to do below.\r\n\t\tif ((correlation>GOOD_ENOUGH_CORRELATION) && (correlation > lastCorrelation)) {\r\n\t\t\tfoundGoodCorrelation = true;\r\n\t\t\tif (correlation > best_correlation) {\r\n\t\t\t\tbest_correlation = correlation;\r\n\t\t\t\tbest_offset = offset;\r\n\t\t\t}\r\n\t\t} else if (foundGoodCorrelation) {\r\n\t\t\t// short-circuit - we found a good correlation, then a bad one, so we'd just be seeing copies from here.\r\n\t\t\t// Now we need to tweak the offset - by interpolating between the values to the left and right of the\r\n\t\t\t// best offset, and shifting it a bit.  This is complex, and HACKY in this code (happy to take PRs!) -\r\n\t\t\t// we need to do a curve fit on correlations[] around best_offset in order to better determine precise\r\n\t\t\t// (anti-aliased) offset.\r\n\r\n\t\t\t// we know best_offset >=1, \r\n\t\t\t// since foundGoodCorrelation cannot go to true until the second pass (offset=1), and \r\n\t\t\t// we can't drop into this clause until the following pass (else if).\r\n\t\t\tvar shift = (correlations[best_offset+1] - correlations[best_offset-1])/correlations[best_offset];  \r\n\t\t\treturn sampleRate/(best_offset+(8*shift));\r\n\t\t}\r\n\t\tlastCorrelation = correlation;\r\n\t}\r\n\tif (best_correlation > 0.01) {\r\n\t\t// console.log(\"f = \" + sampleRate/best_offset + \"Hz (rms: \" + rms + \" confidence: \" + best_correlation + \")\")\r\n\t\treturn sampleRate/best_offset;\r\n\t}\r\n\treturn -1;\r\n//\tvar best_frequency = sampleRate/best_offset;\r\n}\r\n\r\nwindow.pitchDetect = pitchDetect;\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('lib')\r\n    .constant('_', window._) // lodash\r\n    .constant('requestAnimationFrame', (window.requestAnimationFrame || window.webkitRequestAnimationFrame))\r\n    .constant('audioContext', new (window.AudioContext || window.webkitAudioContext || window.mozAudioContext)())\r\n    .constant('getUserMedia', \r\n        navigator.mediaDevices.getUserMedia || \r\n        navigator.mediaDevices.webkitGetUserMedia || \r\n        navigator.mediaDevices.mozGetUserMedia)\r\n    .constant('pitchDetect', window.pitchDetect)\r\n  \r\n})();\r\n\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('common')\r\n    \r\n    .constant('AUDIO_CFG', {\r\n        PITCH_DELTA_ABSOLUTE_THRESHOLD: 50, // cents\r\n        SAMPLE_RATE: 44100, // bit/s\r\n        FFT_SIZE: 2048, // sample block size\r\n        NFFT_SIZE: 1024, // FFT_SIZE / 2\r\n        SMOOTHING_CONSTANT: 0.7, // % 0.0 to 1.0\r\n        SIGNAL_RANGE: {\r\n            min: 0.1,\r\n            max: 4.9,\r\n            clip: 4.4,\r\n        },\r\n        TONE_NAMES: [\r\n            '--',\r\n            'C','C#','D','D#','E','F',\r\n            'F#','G','G#','A','A#','B',\r\n        ],\r\n    })\r\n\r\n})();\r\n\n(function() {\r\n    'use strict';\r\n  \r\n    angular.module('common').run(runBlock);\r\n  \r\n    /** @ngInject */\r\n    function runBlock($log) {\r\n      $log.log('common' + '.run');\r\n    }\r\n  \r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('app').run(runBlock);\r\n\r\n  /** @ngInject */\r\n  function runBlock($log) {\r\n    $log.log('app.run');\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('app').config(routerConfig);\r\n\r\n  /** @ngInject */\r\n  function routerConfig($stateProvider, $urlRouterProvider) {\r\n    $stateProvider.state('app', {\r\n      url: '/',\r\n      component: 'app',\r\n    });\r\n\r\n    $urlRouterProvider.otherwise('/');\r\n  }\r\n\r\n})();\r\n\n(function() {\r\n  'use strict';\r\n\r\n  angular.module('app').config(configBlock);\r\n\r\n  /** @ngInject */\r\n  function configBlock($locationProvider, $logProvider) {\r\n    $locationProvider.\r\n        html5Mode(true);\r\n\r\n    $logProvider.\r\n        debugEnabled(true);\r\n  }\r\n\r\n})();\r\n\nangular.module('app').run(['$templateCache', function($templateCache) {$templateCache.put('index.html','<!DOCTYPE html><html ng-app=app><head><base href=/ ><meta charset=utf-8><meta name=viewport content=\"width=device-width,initial-scale=1\"><title>Pitch Tuner</title><!-- build:css({.tmp/serve,src}) styles/vendor.css --><!-- bower:css --><!-- run `gulp inject` to automatically populate bower styles dependencies --><!-- endbower --><!-- endbuild --><!-- build:css({.tmp/serve,src}) styles/app.css --><!-- inject:css --><!-- css files will be automatically insert here --><!-- endinject --><!-- endbuild --></head><body><app-root><div ui-view=\"\"></div></app-root><!-- build:js(src) scripts/vendor.js --><!-- bower:js --><!-- run `gulp inject` to automatically populate bower script dependencies --><!-- endbower --><!-- endbuild --><!-- build:js({.tmp/serve,.tmp/partials,src}) scripts/app.js --><!-- inject:js --><!-- js files will be automatically insert here --><!-- endinject --><!-- inject:partials --><!-- angular templates will be automatically converted in js and inserted here --><!-- endinject --><!-- endbuild --></body></html>');\n$templateCache.put('app/components/reference-pitch-monitor/reference-pitch-monitor.template.html','<div id=ref-pitch-monitor><div class=rpm-main><div class=ref-pitch><span class=ref-pitch-text>{{ audioState.refPitch.note }}</span></div><div class=pitch-delta><span class=pitch-delta-text>[{{ audioState.pitchDelta }} cents]</span></div></div></div>');\n$templateCache.put('app/components/app/app.template.html','<div class=container-fluid><div class=\"row text-center\"><div class=\"col-md-10 col-md-offset-1\"><alerts instance=vm.alerts tpl-scope=vm></alerts></div></div><div class=widget-row><canvas class=\"col-md-3 col-sm-6 col-xs-5 widget\" db-gauge></canvas><div class=\"col-md-4 col-xs-7 widget\"><reference-pitch-monitor></reference-pitch-monitor></div></div></div><script type=text/ng-template id=inline-partials/enable-mic-alert.html><button class=\"btn btn-primary\" ng-click=\"vm.tplScope.selectInput()\">ENABLE YOUR MIC</button></script><script type=text/ng-template id=inline-partials/not-found-alert.html><strong>Oops!</strong> Please make sure your microphone is plugged in.</script><script type=text/ng-template id=inline-partials/not-supported-alert.html><strong>Oops!</strong> Microphone usage isn\\'t supported on this browser. \\r\\n    Please upgrade to the latest version of \\r\\n    <a href=\"https://www.google.com/intl/en/chrome/browser/desktop/index.html\">Google Chrome</a>\\r\\n    or\\r\\n    <a href=\"https://www.google.com/intl/en/chrome/browser/desktop/index.html\">Mozilla Firefox</a>\\r\\n    or\\r\\n    any browser that supports microphone input.</script><script type=text/ng-template id=inline-partials/unknown-alert.html><strong>Oops!</strong> An unknown error occurred.</script>');\n$templateCache.put('app/components/settings/settings.template.html','settings');\n$templateCache.put('common/components/alerts/alerts.template.html','<div class=alerts><div ng-repeat=\"alert in vm.instance.data\"><div ng-if=\"alert.closeable && alert.show\"><div uib-alert ng-class=\"[\\'alert-\\' + (alert.type || alert.warning), alert.additionalClasses]\" close=vm.instance.closeAlert(alert.id)><div ng-include=alert.templateUrl></div></div></div><div ng-if=\"!alert.closeable && alert.show\"><div uib-alert ng-class=\"[\\'alert-\\' + (alert.type || alert.warning), alert.additionalClasses]\"><div ng-include=alert.templateUrl></div></div></div></div></div>');\n$templateCache.put('common/components/page.collection/page/page.template.html','<div class=\"container-fluid page\"><ng-transclude></ng-transclude></div>');\n$templateCache.put('common/components/page.collection/page-content/page-content.template.html','<div class=\"row page-content\"><div class=col-md-12><ng-transclude></ng-transclude></div></div>');\n$templateCache.put('common/components/page.collection/page-footer/page-footer.template.html','<footer class=\"row page-footer\"><div class=\"col-md-12 page-footer-section\"><a href=# class=\"fa fa-2x fa-twitter-square social-link\" aria-hidden=true></a> <a href=# class=\"fa fa-2x fa-facebook-square social-link\" aria-hidden=true></a> <a href=# class=\"fa fa-2x fa-instagram social-link\" aria-hidden=true></a></div><div class=col-md-12>\\xA9 2017 Copyright: <a href=#>localhost</a></div></footer>');\n$templateCache.put('common/components/page.collection/page-header/page-header.template.html','<header class=\"jumbotron row page-header-x\"><div class=\"container-fluid header-content-container\"><div class=\"col-lg-12 header-content\"><span id=header-version>{{ vm.version }}</span> <span id=header-logo>[ LOGO ]</span></div></div></header>');}]);"],"sourceRoot":"/source/"}